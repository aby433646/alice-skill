import random
from flask import Flask, request, jsonify

# –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–æ–¥–∫–ª—é—á–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å:
# from transformers import pipeline
# generator = pipeline('text-generation', model='gpt2') # –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –¥—Ä—É–≥—É—é –º–∞–ª–µ–Ω—å–∫—É—é –º–æ–¥–µ–ª—å

app = Flask(__name__)

PHRASES = {
    "–ø—Ä–∏–≤–µ—Ç": ["–ô–æ, –±—Ä–∞—Ç—É—Ö–∞! üòé", "–ó–¥–∞—Ä–æ–≤–∞, –∫–æ—Ä–µ—à! üíÄ", "–ô–æ—É, –¥–µ—Ä–∂–∏—Å—å! ü§Ø", "–≠–π, –ø—Ä–∏–≤–µ—Ç! ü´µ"],
    "–ø–æ–≥–æ–¥–∞": ["–ë—Ä–∞—Ç, –Ω–∞ —É–ª–∏—Ü–µ +2, –æ–¥–µ–≤–∞–π —à–∞–ø–∫—É üíÄ", "–Å-–º–∞—ë, –¥–æ–∂–¥—å –ª—å—ë—Ç üòè", "–°–æ–ª–Ω—Ü–µ —Å–≤–µ—Ç–∏—Ç, –Ω–æ –≤–µ—Ç–µ—Ä —Ä–µ–∂–µ—Ç ü§Ø"],
    "—à—É—Ç–∫–∞": ["–ë—Ä–æ, –¥–≤–∞ –ø–∞—Ü–∞–Ω–∞ –∑–∞—Ö–æ–¥—è—Ç –≤ –±–∞—Ä... üíÄ", "–ô–æ, —Å–º–µ—à–Ω–æ –∏–ª–∏ –Ω–µ—Ç, –º–Ω–µ –≤—Å—ë —Ä–∞–≤–Ω–æ ü§Ø"],
    "–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ": ["–ë—Ä–∞—Ç, —è –∫–∞–π—Ñ—É—é üòé", "–©–∞ —á–∏–ª–ª–∏–º üíÄ", "–ü–∞—Ü–∞–Ω, –Ω–∞ —ç–º–æ—Ü–∏—è—Ö ü§¨"],
    "–∂–∞–ª–æ–±–∞": ["–ë—Ä–∞—Ç, –æ–ø—è—Ç—å –≥–ª—é–∫ üò≥", "–©–∞ –≤—Å—ë —Å–ª–æ–º–∞–ª–æ—Å—å ü§Ø", "–Å, –ø—Ä–æ–±–ª–µ–º–∫–∏ üíÄ"],
    "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å": ["–ë—Ä–æ, —Å–ø–∞—Å–∏–±–æ üí™", "–ô–æ, —Ü–µ–Ω—é üòé", "–©–∞ —Ä–µ–∞–ª—å–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω ü§Ø"],
    "–¥—Ä—É–≥–æ–µ": ["–ë—Ä–∞—Ç, —â–∞ –Ω–µ –ø–æ–Ω—è–ª üò≥", "–ü–∞—Ü–∞–Ω, —á—ë —Ç—ã –∏–º–µ–µ—à—å –≤–≤–∏–¥—É? üòè"]
}

EXTRAS = ["üíÄ","üò≥","üòè","ü§Ø","ü´µ","ü§¨","üí™","üòé"]

def detect_category(text):
    text = text.lower()
    if any(word in text for word in ["–ø—Ä–∏–≤–µ—Ç","–∑–¥–∞—Ä–æ–≤–∞","–π–æ"]): return "–ø—Ä–∏–≤–µ—Ç"
    if any(word in text for word in ["–ø–æ–≥–æ–¥–∞","—Å–æ–ª–Ω—Ü–µ","–¥–æ–∂–¥—å","–º–æ—Ä–æ–∑"]): return "–ø–æ–≥–æ–¥–∞"
    if any(word in text for word in ["—à—É—Ç–∫–∞","–∞–Ω–µ–∫–¥–æ—Ç","–ø–æ—Å–º–µ—à–∏"]): return "—à—É—Ç–∫–∞"
    if any(word in text for word in ["–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ","–∫–∞–∫ –¥–µ–ª–∞","–∫–∞–π—Ñ"]): return "–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ"
    if any(word in text for word in ["–∂–∞–ª–æ–±–∞","–ø—Ä–æ–±–ª–µ–º–∞","–≥–ª—é–∫","—Å–ª–æ–º–∞–ª–æ—Å—å"]): return "–∂–∞–ª–æ–±–∞"
    if any(word in text for word in ["—Å–ø–∞—Å–∏–±–æ","—Ü–µ–Ω—é","–±–ª–∞–≥–æ–¥–∞—Ä—é"]): return "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å"
    return "–¥—Ä—É–≥–æ–µ"

def generate_neural_response(text):
    # –ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –Ω–µ–π—Ä–æ–Ω–∫—É
    # –ï—Å–ª–∏ –Ω–µ—Ç –º–æ–¥–µ–ª–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–ª–æ–≤–∞—Ä—è
    # uncomment –Ω–∏–∂–µ –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—à—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
    # response = generator(text, max_length=50, do_sample=True)[0]['generated_text']
    # return response
    return random.choice(PHRASES["–¥—Ä—É–≥–æ–µ"]) + " " + random.choice(EXTRAS)

@app.route("/", methods=["POST"])
def main():
    user_text = request.json.get("request", {}).get("original_utterance", "")
    category = detect_category(user_text)

    # 50% —à–∞–Ω—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞—Ä—å, 50% —à–∞–Ω—Å –Ω–µ–π—Ä–æ–Ω–∫—É
    if random.random() < 0.5:
        phrase = random.choice(PHRASES[category])
    else:
        phrase = generate_neural_response(user_text)
    
    # –ò–Ω–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —ç–º–æ–¥–∑–∏
    if random.random() < 0.3:
        phrase += " " + random.choice(EXTRAS)

    return jsonify({
        "response": {"text": phrase, "end_session": False},
        "version": "1.0"
    })

if __name__ == "__main__":
    app.run()
